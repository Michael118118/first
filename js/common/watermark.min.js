(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')module.exports=factory();else if(typeof define==='function'&&define.amd)define([],factory);else if(typeof exports==='object')exports["watermark"]=factory();else root["watermark"]=factory()})(this,function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})([function(module,exports,__webpack_require__){__webpack_require__(1);module.exports=__webpack_require__(2).default;},function(module,exports){"use strict";exports.__esModule=true;exports["default"]=function(){};module.exports=exports["default"];},function(module,exports,__webpack_require__){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.default=watermark;var _image=__webpack_require__(3);var _canvas=__webpack_require__(5);var _blob=__webpack_require__(6);var _style=__webpack_require__(7);var style=_interopRequireWildcard(_style);var _object=__webpack_require__(10);var _pool=__webpack_require__(11);var _pool2=_interopRequireDefault(_pool);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}var defaults={init:function init(){}};function mergeOptions(options){return(0,_object.extend)((0,_object.clone)(defaults),options)}function release(result,pool){var canvas=result.canvas;var sources=result.sources;var dataURL=(0,_canvas.dataUrl)(canvas);sources.forEach(pool.release);return dataURL}function watermark(resources){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var promise=arguments.length<=2||arguments[2]===undefined?null:arguments[2];var opts=mergeOptions(options);promise||(promise=(0,_image.load)(resources,opts.init));return{dataUrl:function dataUrl(draw){var promise=this.then(function(images){return(0,_image.mapToCanvas)(images,_pool2.default)}).then(function(canvases){return style.result(draw,canvases)}).then(function(result){return release(result,_pool2.default)});return watermark(resources,opts,promise)},load:function load(resources,init){var promise=this.then(function(resource){return(0,_image.load)([resource].concat(resources),init)});return watermark(resources,opts,promise)},render:function render(){var promise=this.then(function(resource){return(0,_image.load)([resource])});return watermark(resources,opts,promise)},blob:function blob(draw){var promise=this.dataUrl(draw).then(_blob.blob);return watermark(resources,opts,promise)},image:function image(draw){var promise=this.dataUrl(draw).then(_image.createImage);return watermark(resources,opts,promise)},then:function then(){for(var _len=arguments.length,funcs=Array(_len),_key=0;_key<_len;_key++){funcs[_key]=arguments[_key]}return promise.then.apply(promise,funcs)}}};watermark.image=style.image;watermark.text=style.text;watermark.destroy=function(){return _pool2.default.clear()};},function(module,exports,__webpack_require__){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.getLoader=getLoader;exports.load=load;exports.loadUrl=loadUrl;exports.loadFile=loadFile;exports.createImage=createImage;exports.imageToCanvas=imageToCanvas;exports.mapToCanvas=mapToCanvas;var _functions=__webpack_require__(4);function _typeof(obj){return obj&&typeof Symbol!=="undefined"&&obj.constructor===Symbol?"symbol":typeof obj}function setAndResolve(img,src,resolve){img.onload=function(){return resolve(img)};img.src=src}function getLoader(resource){var type=typeof resource==='undefined'?'undefined':_typeof(resource);if(type==='string'){return loadUrl}if(resource instanceof Image){return _functions.identity}return loadFile}function load(resources,init){var promises=[];for(var i=0;i<resources.length;i++){var resource=resources[i];var loader=getLoader(resource);var promise=loader(resource,init);promises.push(promise)}return Promise.all(promises)}function loadUrl(url,init){var img=new Image();typeof init==='function'&&init(img);return new Promise(function(resolve){img.onload=function(){return resolve(img)};img.src=url})}function loadFile(file){var reader=new FileReader();return new Promise(function(resolve){var img=new Image();reader.onloadend=function(){return setAndResolve(img,reader.result,resolve)};reader.readAsDataURL(file)})}function createImage(url,onload){var img=new Image();if(typeof onload==='function'){img.onload=onload}img.src=url;return img}function drawImage(img,canvas){var ctx=canvas.getContext('2d');canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);return canvas}function imageToCanvas(img,pool){var canvas=pool.pop();return drawImage(img,canvas)}function mapToCanvas(images,pool){return images.map(function(img){return imageToCanvas(img,pool)})}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sequence=sequence;exports.identity=identity;function sequence(){for(var _len=arguments.length,funcs=Array(_len),_key=0;_key<_len;_key++){funcs[_key]=arguments[_key]}return function(value){return funcs.reduce(function(val,fn){return fn.call(null,val)},value)}}function identity(x){return x}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.dataUrl=dataUrl;function dataUrl(canvas){return canvas.toDataURL()}},function(module,exports,__webpack_require__){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.blob=undefined;exports.split=split;exports.decode=decode;exports.uint8=uint8;var _functions=__webpack_require__(4);var url=/^data:([^;]+);base64,(.*)$/;function split(dataUrl){return url.exec(dataUrl).slice(1)}function decode(base64){return window.atob(base64)}function uint8(data){var length=data.length;var uints=new Uint8Array(length);for(var i=0;i<length;i++){uints[i]=data.charCodeAt(i)}return uints}var blob=exports.blob=(0,_functions.sequence)(split,function(parts){return[decode(parts[1]),parts[0]]},function(blob){return new Blob([uint8(blob[0])],{type:blob[1]})});},function(module,exports,__webpack_require__){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.text=exports.image=undefined;exports.result=result;var _image=__webpack_require__(8);var img=_interopRequireWildcard(_image);var _text=__webpack_require__(9);var txt=_interopRequireWildcard(_text);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}var image=exports.image=img;var text=exports.text=txt;function result(draw,sources){var canvas=draw.apply(null,sources);return{canvas:canvas,sources:sources}}},function(module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.atPos=atPos;exports.lowerRight=lowerRight;exports.upperRight=upperRight;exports.lowerLeft=lowerLeft;exports.upperLeft=upperLeft;exports.center=center;function atPos(xFn,yFn,alpha){alpha||(alpha=1.0);return function(target,watermark){var context=target.getContext('2d');context.save();context.globalAlpha=alpha;context.drawImage(watermark,xFn(target,watermark),yFn(target,watermark));context.restore();return target}}function lowerRight(alpha){return atPos(function(target,mark){return target.width-(mark.width+10)},function(target,mark){return target.height-(mark.height+10)},alpha)}function upperRight(alpha){return atPos(function(target,mark){return target.width-(mark.width+10)},function(target,mark){return 10},alpha)}function lowerLeft(alpha){return atPos(function(target,mark){return 10},function(target,mark){return target.height-(mark.height+10)},alpha)}function upperLeft(alpha){return atPos(function(target,mark){return 10},function(target,mark){return 10},alpha)}function center(alpha){return atPos(function(target,mark){return(target.width-mark.width)/2},function(target,mark){return(target.height-mark.height)/2},alpha)}},function(module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.atPos=atPos;exports.lowerRight=lowerRight;exports.lowerLeft=lowerLeft;exports.upperRight=upperRight;exports.upperLeft=upperLeft;exports.center=center;function atPos(xFn,yFn,text,font,fillStyle,alpha){alpha||(alpha=1.0);return function(target){var context=target.getContext('2d');context.save();context.globalAlpha=alpha;context.fillStyle=fillStyle;context.font=font;for(var i=0;i<text.length;i++){var metrics=context.measureText(text[i]);context.fillText(text[i],xFn(target,metrics,context),yFn(target,metrics,context)-(text.length-1-i)*25)}context.restore();return target}}function lowerRight(text,font,fillStyle,alpha,y){return atPos(function(target,metrics){return target.width-(metrics.width+10)},function(target){return y||target.height-10},text,font,fillStyle,alpha)}function lowerLeft(text,font,fillStyle,alpha,y){return atPos(function(){return 10},function(target){return y||target.height-10},text,font,fillStyle,alpha)}function upperRight(text,font,fillStyle,alpha,y){return atPos(function(target,metrics){return target.width-(metrics.width+10)},function(){return y||20},text,font,fillStyle,alpha)}function upperLeft(text,font,fillStyle,alpha,y){return atPos(function(){return 10},function(){return y||20},text,font,fillStyle,alpha)}function center(text,font,fillStyle,alpha,y){return atPos(function(target,metrics,ctx){ctx.textAlign='center';return target.width/2},function(target,metrics,ctx){ctx.textBaseline='middle';return target.height/2},text,font,fillStyle,alpha)}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.extend=extend;exports.clone=clone;function extend(first,second){var secondKeys=Object.keys(second);secondKeys.forEach(function(key){return first[key]=second[key]});return first}function clone(obj){return extend({},obj)}},function(module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.CanvasPool=CanvasPool;function CanvasPool(){var canvases=[];return{pop:function pop(){if(this.length===0){canvases.push(document.createElement('canvas'))}return canvases.pop()},get length(){return canvases.length},release:function release(canvas){var context=canvas.getContext('2d');context.clearRect(0,0,canvas.width,canvas.height);canvases.push(canvas)},clear:function clear(){canvases.splice(0,canvases.length)},get elements(){return canvases}}}var shared=CanvasPool();exports.default=shared;}])});